{% extends "base.html" %}
{% load static %}
{% load cart_tag %}

{% block css %}
<link rel='stylesheet' href='{% static "css/cart.css" %}'>
{% endblock css %}

{% block js %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js" defer></script>
<script src='{% static "js/delete_in_cart.js" %}' defer></script>
{% endblock %}

{% block content %}
<main class="cart-container">
    <h1 class="cart-title">Ваша корзина</h1>
    
    {% user_cart as carts %}
    {% if carts.exists %}
    <div class="cart-items">
        {% for cart in carts %}
        <div class="cart-item" id="{{ cart.product.id }}">
            <div class="cart-item-image">
                {% if cart.product.image %}
                <img src="{{ cart.product.image.url }}" alt="{{ cart.product.name }}">
                {% else %}
                <img src="{% static 'imgs/default_product.png' %}" alt="Нет изображения">
                {% endif %}
            </div>
            
            <div class="cart-item-details">
                <h3 class="product-name">{{ cart.product.name }}</h3>
                <p class="product-price">{{ cart.product.price }} ₽/шт</p>
                
                <div class="quantity-controls">
                    <form method="post" action="{% url "cart:decrease" %}" class="quantity-form">
                        {% csrf_token %}
                        <button type="submit" class="quantity-btn">-</button>
                    </form>
                    <span class="quantity">{{ cart.quantity }}</span>
                    <form method="post" action="{% url "cart:add_to_cart" %}" class="quantity-form">
                        {% csrf_token %}
                        <button type="submit" class="quantity-btn">+</button>
                    </form>
                </div>
            </div>
            
            <div class="cart-item-actions">
                <p class="item-total">Сумма: {{ cart.products_price }} ₽</p>
                <div class="cart-buttons">
                    <a href="{% url 'products:product' cart.product.slug %}" class="order-btn">Заказать</a>
                    <a href="{% url "cart:remove" %}" class="remove-btn remove_from_cart" data-product-id="{{ cart.product.id }}">Удалить</a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    
    <div class="cart-summary">
        <div class="total-price">
            <span>Итого:</span>
            <span class="total-amount">{{ carts.total_price }} ₽</span>
        </div>
        <a href="" class="checkout-btn">Заказать всё</a>
    </div>
    {% else %}
    <div class="empty-cart">
        <img src="{% static 'imgs/empty_cart.png' %}" alt="Корзина пуста">
        <p>Ваша корзина пуста</p>
        <a href="{% url 'products:products' 'all' %}" class="continue-shopping">Продолжить покупки</a>
    </div>
    {% endif %}
</main>
{% endblock content %}